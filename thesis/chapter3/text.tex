% Text for chapter 1
\chapter{Emission Diagnostics of Coronal Heating}\label{ch:diagnostics}

% Figure manager for Chapter 3
% spell-checker: disable %
\begin{pycode}[chapter3]
name = 'chapter3'
ch3 = texfigure.Manager(
    pytex,
    os.path.join('.', name),
    number=3,
    **{k: os.path.join('.', name, v) for k,v in manager_opts.items()}
)
\end{pycode}
% spell-checker: enable %

Diagnosing the properties of the underlying energy deposition in the corona is nontrivial as measurements are limited to remote sensing data from ground- and space-based instruments. Additionally, until the recently launched Parker Solar Probe mission \citep{fox_solar_2016}, \textit{in situ} measurements were limited to the solar wind at 1 AU. Thus, inferring the dynamics and energy budget of the coronal plasma necessitates the use of multiple diagnostics computed from the observed coronal emission at multiple wavelengths. In \autoref{sec:line_formation}, I discuss the physics of the formation of the optically thin solar spectrum. In \autoref{sec:dem}, I give an overview of the differential emission measure distribution (DEM) and discuss how the DEM can be used to understand the frequency of energy deposition in the solar atmosphere. Lastly, in \autoref{sec:timelag}, I discuss the time-lag analysis technique and show how it can be used to visualize large-scale cooling patterns in active regions.

\section{The CHIANTI Atomic Database}\label{subsec:chianti}

The CHIANTI atomic database \citep{dere_chianti_1997,young_chianti_1998,landi_chianti_1999,dere_chianti-atomic_2001,landi_chianti-atomic_2002,young_chianti-atomic_2003,landi_chianti-atomic_2006,landi_chianti-atomic_2006-1,dere_chianti_2009,landi_chiantiatomic_2009,young_chiantiatomic_2009,landi_chiantiatomic_2012,landi_chiantiatomic_2013,del_zanna_chianti_2015,young_chianti_2016} is an essential tool for performing spectroscopy of optically-thin astrophysical plasmas such as the solar corona. It is primarily used in the study of the solar atmosphere though it has broader astrophysical applications as well \citep[see Figure 4 of][]{young_chianti_2016}. The database provides information on atomic transitions for all ions of over 30 different elements, from hydrogen to zinc. For a given ion, CHIANTI provides wavelengths and energies (among other information) for many thousands of atomic transitions as well as various derived quantities, including the ionization and recombination rates, energy level populations, and spectral line intensities. Additionally, CHIANTI provides multiple measurements of elemental abundances in both the corona and photosphere. Data and routines are also included for computing the free-free and free-bound continuum emission. 

The CHIANTI project is an international collaboration between the University of Cambridge, the University of Michigan, and George Mason University and is an invaluable asset to the solar physics community. Version 1.0 of the database was released in 1995 and at the time of writing, the current version is 8.0.7. Users typically interact with the database via the provided Interactive Data Language (IDL) routines or the more recently-released ChiantiPy package \citep{landi_chiantiatomic_2012,barnes_chiantipy_2017}, an interface to CHIANTI implemented in the Python programming language. All work presented in this thesis makes heavy use of the CHIANTI atomic database via the fiasco Python package (see \autoref{ap:fiasco}).

\section{Spectral Line Formation}\label{sec:line_formation}

The solar corona is \textit{optically thin}, meaning that all emitted photons are observed and that these photons are not absorbed or scattered between the emission site and detector. Because these photons travel uninterrupted, they provide a direct signature of the properties of the coronal plasma. One of the primary mechanisms for the formation of spectral emission lines in the solar corona is the spontaneous radiative decay of an electron in an excited state $j$ to a lower energy state $i$,
\begin{equation}\label{eq:radiative_decay}
    X_{k,j} \to X_{k,i} + h\nu_{ji},
\end{equation}
where $X_k$ is an ion of element $X$ in ionization stage $k$, $\nu_{ji}$ is the frequency of the atomic transition, and $h\nu_{ji}$ is the energy of the emitted photon.

The intensity of a spectral line for an atomic transition of wavelength $\lambda_{ji}=c/\nu_{ji}$, where $c$ is the speed of light in a vacuum, is given by,
\begin{equation}\label{eq:intensity}
    I(\lambda_{ji}) = \frac{1}{4\pi}\int\textup{d}h\,P(\lambda_{ji}),
\end{equation}
where the integration is taken along the line-of-sight (LOS) between the observer the emission site and $P(\lambda_{ji})$ is the \textit{emissivity}, or the radiative power per unit volume. The emissivity is given by,
\begin{equation}\label{eq:emissivity}
    P(\lambda_{ji}) = \frac{hc}{\lambda_{ji}}n_{X,k,j}A_{ji},
\end{equation}
where $n_{X,k,j}$ is the number density of $X_k$ ions in excited state $j$ and $A_{ji}$ is the probability of spontaneous emission, often referred to as the Einstein coefficient \citep{bradshaw_collisional_2013,del_zanna_solar_2018}.

In general, it is quite difficult to determine $n_{X,k,j}$, the density of ions in excited state $j$. As such, we can rewrite $n_{X,k,j}$ as,
\begin{align}\label{eq:nj}
    n_{X,k,j} &= \frac{n_{X,k,j}}{n_{X,k}}\frac{n_{X,k}}{n_X}\frac{n_X}{n_H}\frac{n_H}{n_e}n_e, \nonumber\\
              &= N_{X,k,j}f_{X,k}\textup{Ab}(X)\frac{n_H}{n_e}n_e,
\end{align}
where $n_e$ is the electron density, $\textup{Ab}(X)=n_X/n_H$ is the abundance of element $X$ relative to hydrogen, $n_H/n_e$ is the ratio of hydrogen ions to electrons, often approximated as $n_H/n_e\approx0.83$, $N_{X,k,j}=n_{X,k,j}/n_{X,k}$ is the level population of level $j$ or the fraction of $X_k$ ions in excited state $j$, and $f_{X,k}=n_{X,k}/n_X$ is the population fraction of ion $X_k$ \citep{del_zanna_solar_2018}. Plugging \autoref{eq:nj} into \autoref{eq:emissivity} yields a more convenient expression for the emissivity,
\begin{equation}\label{eq:emissivity_simplified}
    P(\lambda_{ji}) = 0.83\frac{hc}{\lambda_{ji}}\textup{Ab}(X)f_{X,k}N_{X,k,j}A_{ji}n_e.
\end{equation}
Both $\textup{Ab}(X)$ and $A_{ji}$, which is a function of electron temperature, $T_e$, can be looked up in the CHIANTI atomic database (see \autoref{subsec:chianti}). $N_{X,k,j}$ is a function of both $T_e$ and $n_e$ and can be computed by assuming the the excitation and deexcitation processes are in equilibrium. This is discussed in \autoref{subsec:collisional_excitation} and \autoref{subsec:level_pops}. $f_{X,k}$ is primarily a function of $T_e$ and is discussed in \autoref{subsec:ionization_recombination} and \autoref{subsec:ioneq_versus_nei}. Thus, for a given distribution of $T_e$ and $n_e$ along the LOS, we can compute the intensity of a transition $\lambda_{ji}$ using \autoref{eq:emissivity_simplified} and \autoref{eq:intensity}.

\subsection{Collisional Excitation of Atomic Levels}\label{subsec:collisional_excitation}

For a photon to be produced by spontaneous radiative decay from excited state $j$ to lower energy state $i$ (see \autoref{eq:radiative_decay}), the ion must first be excited into state $j$. In the solar atmosphere, the most important excitation process is the inelastic collisions between ions and free electrons,
\begin{equation}\label{eq:inelastic_collisions}
    X_{k,i} + e(E_{\textup{initial}}) \to X_{k,j} + e(E_{\textup{final}})
\end{equation}
where $e$ denotes the free electron and $E_{\textup{initial}}$ and $E_{\textup{final}}$ are the initial and final energies of the electron, respectively \citep{phillips_ultraviolet_2008}. The initial and final energies of the ion are $E_i$ and $E_j$, respectively. If $E_i<E_j$, $X_k$ has been \textit{collisionally excited} from a lower to a higher energy state and the free electron has lost an amount of energy equal to the separation between these two levels,
\begin{equation*}
    E_{\textup{final}} - E_{\textup{initial}}  = E_i - E_j.
\end{equation*}
Conversely, if $E_i>E_j$, $X_k$ is \textit{collisionally deexcited} from $i$ to $j$ and the free electron gains an amount of energy equal to $E_i - E_j$.

\hilite{Production of satellite lines via dielectronic recombination important for levels above the ionization potential}

In order to understand how energy levels are populated and depopulated by collisions, it is necessary to compute the rate at which collisions occur in a plasma with electron temperature $T_e$ for an ion $X_k$. I will now derive the excitation and deexcitation rate coefficients. This derivation closely follows the treatment in sections 3.2 and 3.3 of \citet{del_zanna_solar_2018} as well as section 4.2 of \citet{phillips_ultraviolet_2008}.  

The rate coefficient for collisional excitation is given by,
\begin{equation}\label{eq:rate_coefficient}
    C^e_{ij} = \int_{v_0}^{\infty}\textup{d}v\,v\sigma_{ij}(v)f(v),
\end{equation}
where $v$ is the electron velocity, $\sigma_{ij}(v)$ is the cross-section for inelastic collisions between the ion and electron, and $f(v)$ is the velocity distribution function of the electrons. Additionally, $v_0$ is the threshold velocity such that $m_ev_0^2/2 = E_j - E_i$, where $m_e$ is the mass of the electron. Any electron with $v<v_0$ will not be able to excite atom from level $i$ to $j$. It is commonly assumed that the distribution of free electrons in the solar atmosphere is in thermodynamic equilibrium such that it is well-described by a Maxwell-Boltzmann distribution\footnote{Observations of non-thermal particles \citep[e.g][]{dzifcakova_diagnostics_2011} suggest that the distribution of free electrons in the solar corona may be better described by a $\kappa$-distribution. For more details see \citet{cranmer_suprathermal_2014} or the comprehensive review by \citet{dudik_nonequilibrium_2017}.},
\begin{equation}\label{eq:maxwellian}
    f(v) = 4\pi v^2 \left(\frac{m_e}{2\pi k_BT_e}\right)^{3/2}\exp{\left(-\frac{m_ev^2}{2k_BT_e}\right)},
\end{equation}
where $k_B$ is the Boltzmann constant. Plugging \autoref{eq:maxwellian} into \autoref{eq:rate_coefficient},
\begin{equation*}
    C^e_{ij} =  4\pi\left(\frac{m_e}{2\pi k_BT_e}\right)^{3/2}\int_{v_0}^{\infty}\textup{d}v\,v^3\sigma_{ij}(v)\exp{\left(-\frac{m_ev^2}{2k_BT_e}\right)},
\end{equation*}
and making the change of variables $E=m_ev^2/2$,
\begin{align}\label{eq:rate_coefficient_e}
    C^e_{ij} &= 4\pi\left(\frac{m_e}{2\pi k_BT_e}\right)^{3/2}\int_{E_0}^{\infty}\textup{d}E\,\frac{2E}{m_e^2}\sigma_{ij}(E)\exp{\left(-\frac{E}{k_BT_e}\right)},\nonumber\\
    &= \sqrt{\frac{8}{\pi m_e}}(k_BT_e)^{-3/2}\int_{E_0}^{\infty}\textup{d}E\,E\sigma_{ij}(E)\exp{\left(-\frac{E}{k_BT_e}\right)},\nonumber\\
    &= \sqrt{\frac{8k_BT_e}{\pi m_e}}\int_{E_0}^{\infty}\textup{d}\left(\frac{E}{k_BT_e}\right)\,\frac{E}{k_BT_e}\sigma_{ij}(E)\exp{\left(-\frac{E}{k_BT_e}\right)},
\end{align}
where $E_0=mv_0^2/2=E_j-E_i$ is the minimum electron energy required to excite the ion from $i$ to $j$.

The cross-section for excitation by inelastic collisions can be expressed as,
\begin{equation}\label{eq:cross_section}
    \sigma_{ij}(E) = \pi a_0^2 \Omega_{ij}(E)\frac{I_H}{\omega_iE},
\end{equation}
where $a_0$ is the Bohr radius, $I_H$ is the ionization potential of hydrogen, $\omega_i$ is the statistical weight of level $i$, and $\Omega_{ij}$ is the dimensionless collision strength. It should be noted that $\Omega_{ij}$ is symmetric such that $\Omega_{ij}(E)=\Omega(E^{\prime})$, where $E^{\prime}=E - E_{ij} = E - (E_j - E_i)$ is the final energy of the electron after it has been scattered. Plugging \autoref{eq:cross_section} into \autoref{eq:rate_coefficient_e},
\begin{equation}
    C^e_{ij} = I_Ha_0^2\sqrt{\frac{8\pi}{k_Bm_e}}\omega_i^{-1}T_e^{-1/2}\int_{E_0}^{\infty}\textup{d}\left(\frac{E}{k_BT_e}\right)\,\Omega_{ij}(E)\exp{\left(-\frac{E}{k_BT_e}\right)}.
\end{equation}
Exploiting the symmetry of $\Omega_{ij}$ and making a change of variables to $E^{\prime}$ gives,
\begin{align}\label{eq:rate_coefficient_final}
    C^e_{ij} &= I_Ha_0^2\sqrt{\frac{8\pi}{k_Bm_e}}\omega_i^{-1}T_e^{-1/2}\int_{E_0}^{\infty}\textup{d}\left(\frac{E}{k_BT_e}\right)\,\Omega_{ji}(E^\prime)\exp{\left(-\frac{E}{k_BT_e}\right)} \nonumber\\
    &= I_Ha_0^2\sqrt{\frac{8\pi}{k_Bm_e}}\omega_i^{-1}T_e^{-1/2}\int_{0}^{\infty}\textup{d}\left(\frac{E^\prime}{k_BT_e}\right)\,\Omega_{ji}(E^\prime)\exp{\left(-\frac{E^\prime + E_{ij}}{k_BT_e}\right)} \nonumber\\
    &= I_Ha_0^2\sqrt{\frac{8\pi}{k_Bm_e}}T_e^{-1/2}\frac{\Upsilon_{ij}}{\omega_i}\exp{\left(-\frac{E_{ij}}{k_BT_e}\right)}
\end{align}
where the term $\Upsilon_{ij}$, originally introduced by \citet{seaton_electron_1953}, is called the effective collision strength (or alternatively the Maxwellian-averaged collision strength) and is defined as,
\begin{equation}\label{eq:effective_collision_strength}
    \Upsilon_{ij} = \int_{0}^{\infty}\textup{d}\left(\frac{E}{k_BT_e}\right)\,\Omega_{ji}(E)\exp{\left(-\frac{E}{k_BT_e}\right)},
\end{equation}
where $E$ is now the final energy of the electron after the collision.

In general, computing cross-sections for excitations by collisions with free-electrons is very difficult and time consuming and requires the use of sophisticated atomic codes which properly account for the energy levels of the target ion and the detailed physics of the interaction between the free electron and target ion \citep[][section 4.2.3]{phillips_ultraviolet_2008,bautista_theoretical_2000}. \citet{burgess_analysis_1992} computed fit coefficients to $\Upsilon$ as a function of $T_e$ in terms of compact, dimensionless variables for a large number of atomic transitions. Reduced fit parameters for $\Upsilon$ are provided in the CHIANTI atomic database using the methods of \citet{burgess_analysis_1992} for all relevant transitions such that effective collision strengths can be efficiently computed for arbitrary $T_e$. \autoref{fig:upsilon} shows $\Upsilon$ as a function of $T_e$ for several selected transitions of Fe XII.

% spell-checker: disable %
\begin{pycode}[chapter3]
fig = plt.figure(figsize=texfigure.figsize(pytex,scale=0.75,))
ax = fig.gca()
T = np.logspace(5.5,7.5,100) * u.K
ion = fiasco.Ion('Fe 12', T)
ups = ion.effective_collision_strength()
index = np.where(np.logical_and(ups[0,:] < 1,ups[-1,:]>1e-3))[0][:100]
ax.plot(T, ups[:, index], color=PALETTE[0], alpha=0.25)
ax.set_xlabel(r'$T_e$ [K]')
ax.set_ylabel(r'$\Upsilon$')
ax.set_xscale('log')
ax.set_yscale('log')
ax.set_xlim(T[[0,-1]].value)
ax.set_ylim(1e-3,1)
tfig = ch3.save_figure('upsilon', fext='.pgf')
tfig.caption = r'Effective collision strength, $\Upsilon$, as a function of $T_e$ for 100 selected transitions in Fe XII. $\Upsilon$ was interpolated to $T_e$ using fit coefficients provided by the CHIANTI atomic database and computed using the method of \citet{burgess_analysis_1992}'
\end{pycode}
\py[chapter3]|tfig|
% spell-checker: enable %

The rate coefficient for deexcitation can also be computed using \autoref{eq:rate_coefficient_final}, the excitation rate coefficient. Under the assumption of thermodynamic equilibrium, the processes of excitation and deexcitation by collisions must be in balance such that 
\begin{equation}\label{eq:eqbm_balance}
    n_in_eC_{ij}^e = n_jn_eC_{ji}^d,
\end{equation}
where $C_{ji}^d$ is the rate coefficient for collisional deexcitation, and the populations of the two levels are in Boltzmann equilibrium,
\begin{equation}\label{eq:boltzmann_eqbm}
    \frac{n_i}{n_j} = \frac{\omega_i}{\omega_j}\exp{\left(\frac{E_{ij}}{k_BT_e}\right)},
\end{equation}
where $\omega_i$ and $\omega_j$ are the statistical weights of levels $i$ and $j$, respectively. Combining \autoref{eq:eqbm_balance} and \autoref{eq:boltzmann_eqbm} gives an expression for $C_{ji}^d$, the deexcitation rate coefficient,
\begin{align}\label{eq:dex_rate_coefficient}
    C_{ji}^d &= \frac{\omega_i}{\omega_j}C_{ij}^e\exp{\left(\frac{E_{ij}}{k_BT_e}\right)},\nonumber\\
    &= I_Ha_0^2\sqrt{\frac{8\pi}{k_Bm_e}}T_e^{-1/2}\frac{\Upsilon_{ij}}{\omega_j}.
\end{align}

\subsection{Level Populations}\label{subsec:level_pops}

In optically-thin, astrophysical plasmas, it is often assumed that the processes which influence populations of atomic energy levels are decoupled from those processes which influence the charge state of the atom (see \autoref{subsec:ionization_recombination}). This is because changes in the energy level populations occur much more frequently than changes in the charge state. Another common approximation is that energy levels are populated primarily by collisional excitation and depopulated by spontaneous radiative decay and that these processes occur primarily between the ground state $g$ and an excited state $j$. Assuming a steady-state equilibrium between these processes,
\begin{equation}\label{eq:coronal_model}
    n_{X,k,g}n_eC_{gj}^e = n_{X,k,j}A_{jg},
\end{equation}
where the left-hand side corresponds to processes that populate $j$ and the right-hand side corresponds to processes that depopulate $j$. Taken together, these assumptions are often referred to as the \textit{coronal model approximation} \citep{bradshaw_collisional_2013,del_zanna_solar_2018}. 

The coronal model approximation assumes a two-level system ($g$ and $j$) in which the only two competing processes are excitation by collisions and spontaneous radiative decay. However, an ion may have so-called \textit{metastable levels} where the probability of spontaneous radiative decay is very low such that depopulation by collisional deexcitation is not negligible \citet{phillips_ultraviolet_2008,del_zanna_solar_2018}. In this case, the level population calculation must account for transitions between excited states such that the two-level approximation is no longer appropriate. Thus, for a multi-level atom, the system of equations required to calculate the population of $n_j$ (temporarily droppping the $X,k$ subscripts),
\begin{equation}\label{eq:level_pop}
\sum_{i>j}n_iA_{ij} + n_e\sum_{i>j}n_iC_{ij}^d + n_e\sum_{i<j}n_iC_{ij}^e
= n_j\left(\sum_{i<j}A_{ji} + n_e\sum_{i<j}C_{ji}^d + n_e\sum_{i>j}C_{ji}^e\right),
\end{equation}
where the left-hand side denotes processes which populate level $j$ and the right-hand side denotes processes that depopulate level $j$ \citep{del_zanna_solar_2018}. $C_{ij}^e$ and $C_{ji}^d$ can be computed from \autoref{eq:rate_coefficient_final} and \autoref{eq:dex_rate_coefficient}, respectively. Values for $A_{ji}$ as a function of $T_e$ are available in CHIANTI. Additional processes such as collisional excitation by protons or photoionization by an external radiation field may also influence $n_j$ \citep[see sections 3.4.1 and 3.4.2 of][]{del_zanna_solar_2018}.

In general, the level population $n_j$ is a function of both temperature and density. As \autoref{eq:level_pop} is a system of $J$ coupled equations, where $J$ is the total number of energy levels of the ion, calculating $n_j$ requires solving a $J\times J$ matrix equation and can be very computationally expensive, depending on the number of energy levels and relevant atomic transitions. \autoref{fig:level-pop} shows the level populations of several energy levels of O II as a function of electron energy at $10^6$ K. The resulting relative level population for level $j$ of charge state $k$ of element $X$, $N_{X,k,j}$, can then be used to compute the emissivity for transition $\lambda_{ji}$ (\autoref{eq:emissivity_simplified}) and the resulting spectral line intensity (\autoref{eq:intensity}).

% spell-checker: disable %
\begin{pycode}[chapter3]
ion = fiasco.Ion('O 2', [1e6]*u.K)
n = np.logspace(3,12,100)*u.cm**(-3)
pop = ion.level_populations(n)

# Function for making spectroscopic notation for energy levels
def make_level_label(i):
    spec = r'$^{s}\mathrm{{{l}}}_{{{j}}}$'.format(
        j = str(Fraction(ion[i].total_angular_momentum.value)),
        s = ion._elvlc['multiplicity'][i],
        l = ion[i].orbital_angular_momentum_label
    )
    return f"{ion[i].level}: {' '.join(ion[i].configuration.split('.'))} {spec}"

fig = plt.figure(figsize=texfigure.figsize(pytex,scale=0.75,))
ax = fig.gca()
num_levels = 5
for i in range(num_levels):
    ax.plot(n, pop[0,:,i], label=make_level_label(i), color=PALETTE[i])
ax.set_xscale('log')
ax.set_yscale('log')
ax.set_ylim(1e-3,2)
ax.set_xlim(n[0].value,n[-1].value)
ax.set_xlabel(r'$n_e$ [cm$^{-3}$]')
ax.set_ylabel(r'$N_j$')
ax.legend(loc=4,frameon=False,ncol=2)
tfig = ch3.save_figure('level-pop', fext='.pgf')
tfig.caption = r'Level population of the first five levels of O II as a function of electron density, $n_e$, at $T_e=10^6$ K. Note that the ground state is the most abundant for all $n_e$. The level population is normalized to the total number of O II ions such that $\sum_jN_j=1$. Adapted from Fig. 4.3 of \citet{phillips_ultraviolet_2008}.'
\end{pycode}
\py[chapter3]|tfig|
% spell-checker: enable %

\subsection{Processes which Affect the Ion Charge State}\label{subsec:ionization_recombination}

In addition to the relative populations of each energy level of the ion, one must also know the population of each \textit{charge state} of the ion in order to compute the emissivity (\autoref{eq:emissivity_simplified}). The relative population fraction of a charge state $k$ of element $X$, denoted $f_{X,k}=n_{X,k}/n_X$, is the number of ions of element $X$ in charge state $k$ relative to the total number of ions of element $X$. Ion charge states are determined by two primary processes: \textit{ionization}, in which a bound electron is freed by some external perturbation, and \textit{recombination}, in which a a free electron is captured by the ion. Thus, the time evolution of the population fraction $f_k$ (temporarily dropping the element label) is given by,
\begin{equation}\label{eq:population_fraction}
    \frac{d}{dt}f_k = n_e(\alpha_{k-1}^I f_{k-1} + \alpha_{k+1}^R f_{k+1} - \alpha_{k}^I f_k - \alpha_k^R f_k),
\end{equation}
where $\alpha_k^I$ and $\alpha_k^R$ are the ionization and recombination rates of charge state $k$, respectively \citep{del_zanna_solar_2018}. Note that ionization from lower charge states and recombination from higher charge states are source terms while ionization and recombination out of the current charge state are sinks. Solutions to \autoref{eq:population_fraction} are discussed in \autoref{subsec:ioneq_versus_nei}.

\subsubsection{Ionization}

In optically-thin astrophysical plasmas such as the solar corona, the dominant processes contributing to the total ionization rate are collisional (or direct) ionization and excitation-autoionization \citep{bradshaw_collisional_2013}. Thus, the total ionization rate can be written as,
\begin{equation}\label{eq:total_ionization_rate}
    \alpha^I = \alpha^\textup{CI} + \alpha^\textup{EA},
\end{equation}
where $\alpha^\textup{CI}$ and $\alpha^\textup{EA}$ are the ionization rates due collisional ionization and excitation-autoionization, respectively. In the process of collisional ionization, a free electron collides with an ion $X_k$ and frees a bound electron. Following the notation of \citet{bradshaw_patterns_2016,mason_spectroscopic_1994}, this can be expressed as,
\begin{equation}\label{eq:collisional_ionization}
    X_{k,i} + e \to X_{k+1,i^\prime} + 2e,
\end{equation}
where $i^\prime$ denotes the final energetic state of $X_{k+1}$. 

$\alpha_{CI}$ can be computed in a similar manner to $C^e_{ij}$ by integrating the velocity-weighted collision cross-section over a Maxwell-Boltzmann distribution. Using the result from \autoref{eq:rate_coefficient_e}, the ionization rate due to collisional ionization can be written as,
\begin{equation}
    \alpha^\textup{CI} = \sqrt{\frac{8}{\pi m_e}}(k_BT_e)^{-3/2}\int_I^{\infty}\textup{d}E\,E\sigma_{CI}(E)\exp{\left(-\frac{E}{k_BT_e}\right)}
\end{equation}
where $E$ is the energy of incident electron, $\sigma_{CI}$ is the collisional ionization cross-section and $I$ is the ionization energy of the initially-bound electron \citep{del_zanna_solar_2018}. Making the change of variables $x=(E-I)/k_BT_e$ gives,
\begin{equation}\label{eq:collisional_ionization_x}
\begin{aligned}
    \alpha^\textup{CI} = \sqrt{\frac{8}{\pi m_e}}(k_BT_e)^{-1/2}\exp{\left(-\frac{I}{k_BT_e}\right)}&\left(k_BT_e\int_0^{\infty}\textup{d}x\,x\sigma_{CI}(k_BT_ex+I)e^{-x} \right. \\
    &\left. + I\int_0^{\infty}\textup{d}x\,\sigma_{CI}(k_BT_ex+I)e^{-x}\right).
\end{aligned}
\end{equation}
Notice that both integrals have the same form and can be evaluated using Gauss-Laguerre quadrature,
\begin{equation}
    \int_0^\infty\textup{d}x\,f(x)e^{-x} \approx \sum_{i=1}^n w_if(x_i),
\end{equation}
where $x_i$ is zero of the $i$-th Laguerre polynomial and $w_i$ are the associated weights \citep[see Equation 25.4.45 of][]{abramowitz_handbook_1972}. As in the case of collisional excitation, evaluating the cross-section for collisional ionization $\sigma_\textup{CI}$ is non-trivial. For ions in the hydrogen and helium isoelectronic sequences (i.e. ions with the same number of electrons as hydrogen or helium), $\sigma_\textup{CI}$ can be evaluated using the fitting formula of \citet{fontes_fully_1999}. Additionally, \citet{dere_ionization_2007} computed fit coefficients for collisional ionization for a large number of ions using the method of \citet{burgess_analysis_1992}. Fit parameters for both of these methods are provided by the CHIANTI database and can be used to efficiently compute $\sigma_\textup{CI}$ as a function of $T_e$.

\hilite{short paragraph about excitation autoionization}

\subsubsection{Recombination}

\hilite{Recombination: radiative recombination, dielectronic recombination}

% spell-checker: disable %
\begin{pycode}[chapter3]
ion = fiasco.Ion('Fe 16', np.logspace(4,9,100)*u.K)
fig = plt.figure(figsize=texfigure.figsize(pytex,scale=0.75,))
ax = fig.gca()
# ionization
ax.plot(ion.temperature,ion.ionization_rate(),color=PALETTE[0],ls='-',label=r'$\alpha^I$')
ax.plot(ion.temperature,ion.direct_ionization_rate(),color=PALETTE[0],ls='--',label=r'$\alpha^\textup{CI}$')
ax.plot(ion.temperature,ion.excitation_autoionization_rate(),color=PALETTE[0],ls='-.',label=r'$\alpha^\textup{EA}$')
# recombination
ax.plot(ion.temperature,ion.recombination_rate(),color=PALETTE[1],ls='-',label=r'$\alpha^R$')
ax.plot(ion.temperature,ion.radiative_recombination_rate(),color=PALETTE[1],ls='--',label=r'$\alpha^\textup{RR}$')
ax.plot(ion.temperature,ion.dielectronic_recombination_rate(),color=PALETTE[1],ls='-.',label=r'$\alpha^\textup{DR}$')
ax.set_xscale('log')
ax.set_yscale('log')
ax.set_ylim(1e-12,1e-9)
ax.set_xlim(ion.temperature[[0,-1]].value)
ax.set_xlabel(r'$T_e$ [K]')
ax.set_ylabel(r'$\alpha$ [cm$^3$ s$^{-1}$]')
ax.legend(loc=4,ncol=1,frameon=False)
tfig = ch3.save_figure('ionization-recombination-rates', fext='.pgf')
tfig.caption = r'Ionization (blue) and recombination (orange)rates as a function of electron temperature, $T_e$, for Fe XVI. Note that the recombination rate dominates at low $T_e$ while the ionization rate dominates at $T_e$ as expected.'
\end{pycode}
\py[chapter3]|tfig|
% spell-checker: enable %

\subsection{Equilibrium versus Nonequilibrium Charge States}\label{subsec:ioneq_versus_nei}

\hilite{Discuss breakdown of assumption of ionization equilibrium; show plot of equilibrium charge states; show plot of effective temperature for NEI charge states or population fraction(s) as a function of time for an example calculation in which IEQ != NEI}

\section{Continuum Emission}\label{sec:continuum}

\hilite{Not sure if this section is needed since we don't deal with continuum much though it is still an important mechanism}

\subsection{Free-free Emission}

\subsection{Free-bound Emission}

\section{The Differential Emission Measure Distribution}\label{sec:dem}

\hilite{Write intensity in terms of contribution function; define contribution function; define DEM}

\subsection{Inversion Methods}

\subsection{The Emission Measure Slope}

\subsection{Inferring the Presence of Very Hot Plasma}

\section{Time-lag Analysis}\label{sec:timelag}

\hilite{Theory, show example with Gaussian pulses, discuss AIA channel sensitivity, relate time lag to cooling time}

\subsection{Cross-correlation}

\subsection{Temperature Sensitivity of the AIA Passbands}

\subsection{Time lag between AIA Channel Pairs}

\section{Summary}

% Nomenclature
\nomenclature[z-au]{AU}{astronomical unit}
\nomenclature[z-dem]{DEM}{differential emission measure}
\nomenclature[a-h]{$h$}{Planck constant}
\nomenclature[a-c]{$c$}{speed of light in a vacuum}
\nomenclature[g-nu]{$\nu$}{photon frequency}
\nomenclature[s-k]{$k$}{ionization stage}
\nomenclature[z-los]{LOS}{line-of-sight}
\nomenclature[z-nei]{NEI}{nonequilibrium ionization}
\nomenclature[a-te]{$T_e$}{electron temperature}
\nomenclature[a-ne]{$n_e$}{electron density}
\nomenclature[a-kb]{$k_B$}{Boltzmann constant}
